<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NAR-PPF Store</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --primary: #007aff; /* –°–∏–Ω–∏–π —Ü–≤–µ—Ç –∫–∞–∫ –Ω–∞ —Å–∞–π—Ç–µ/—Å–∫—Ä–∏–Ω—à–æ—Ç–µ */
            --bg: #f2f2f7;      /* –°–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π —Ñ–æ–Ω */
            --card: #ffffff;    /* –ë–µ–ª—ã–µ –ø–ª–∞—à–∫–∏ */
            --text: #000000;
            --gray-text: #8e8e93;
            --border: #c6c6c8;
            --danger: #ff3b30;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0; padding: 0;
            -webkit-tap-highlight-color: transparent;
            padding-bottom: 90px; /* –û—Ç—Å—Ç—É–ø –ø–æ–¥ –Ω–∏–∂–Ω–µ–µ –º–µ–Ω—é */
        }

        /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Ä–∞–∑–¥–µ–ª–æ–≤ */
        .section-header {
            padding: 20px 16px 8px;
            font-size: 13px;
            text-transform: uppercase;
            color: var(--gray-text);
            font-weight: 600;
        }

        /* –¢–∞–±–ª–∏—á–Ω—ã–π –±–ª–æ–∫ (–∫–∞–∫ –≤ iOS/Bunch) */
        .list-group {
            background: var(--card);
            border-top: 0.5px solid var(--border);
            border-bottom: 0.5px solid var(--border);
            margin-bottom: 20px;
        }

        .list-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 0.5px solid #e5e5ea;
            min-height: 44px;
        }
        
        .list-item:last-child { border-bottom: none; }

        .item-label { flex: 1; font-size: 17px; font-weight: 500; }
        
        /* –≠–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–º */
        .item-controls { display: flex; align-items: center; gap: 10px; }

        .segment-control {
            display: flex; background: #efeff4;
            padding: 2px; border-radius: 8px;
        }
        
        .segment-btn {
            border: none; background: none;
            padding: 4px 10px; font-size: 13px; font-weight: 500;
            border-radius: 6px; cursor: pointer;
        }
        
        .segment-btn.active {
            background: var(--card);
            box-shadow: 0 1px 3px rgba(0,0,0,0.15);
            color: var(--primary);
        }

        .qty-input {
            width: 50px; padding: 6px;
            text-align: center; border-radius: 8px;
            border: 1px solid #e5e5ea; font-size: 16px;
            background: #f9f9f9;
        }

        /* –ü–æ–ª—è –≤–≤–æ–¥–∞ */
        .input-plain {
            width: 100%; border: none; outline: none;
            font-size: 17px; background: transparent;
            text-align: right; color: var(--primary);
        }
        .input-plain::placeholder { color: var(--gray-text); }
        
        select.input-plain { direction: rtl; appearance: none; }

        /* –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è (Tab Bar) */
        .tab-bar {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            border-top: 0.5px solid #b2b2b2;
            display: flex; justify-content: space-around;
            padding-bottom: 20px; /* –î–ª—è iPhone X+ */
            padding-top: 10px;
            z-index: 1000;
        }

        .tab-item {
            display: flex; flex-direction: column; align-items: center;
            font-size: 10px; color: var(--gray-text);
            gap: 4px; cursor: pointer; width: 60px;
        }

        .tab-item.active { color: var(--primary); }
        
        .tab-icon { font-size: 24px; line-height: 1; }

        /* –≠–∫—Ä–∞–Ω—ã */
        .screen { display: none; }
        .screen.active { display: block; animation: fadeIn 0.2s; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* –ö–Ω–æ–ø–∫–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è */
        .main-btn {
            background: var(--primary); color: white;
            border: none; width: 100%; padding: 16px;
            border-radius: 12px; font-size: 17px; font-weight: 600;
            margin-top: 20px; cursor: pointer;
        }
        .main-btn:active { opacity: 0.8; }

        .hint-text { padding: 0 16px; font-size: 13px; color: var(--gray-text); margin-bottom: 10px; }
        
        /* –°—á–µ—Ç—á–∏–∫ –≤ —Ç–∞–±–±–∞—Ä–µ */
        .badge {
            position: absolute; top: -5px; right: 10px;
            background: var(--danger); color: white;
            font-size: 10px; padding: 2px 6px; border-radius: 10px;
            display: none;
        }
    </style>
</head>
<body>

<div id="tab-menu" class="screen active">
    <div class="section-header">–ö–∞—Ç–∞–ª–æ–≥ –ø–ª–µ–Ω–æ–∫</div>
    <div class="list-group" id="catalog-list">
        </div>
    <div class="hint-text">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø (–†—É–ª–æ–Ω/–ú–µ—Ç—Ä) –∏ —É–∫–∞–∂–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ.</div>
</div>

<div id="tab-cart" class="screen">
    <div class="section-header">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–æ—Å—Ç–∞–≤–∫–∏</div>
    <div class="list-group">
        <div class="list-item">
            <div class="item-label">–ì–æ—Ä–æ–¥</div>
            <select id="city" class="input-plain" onchange="toggleCustomCity()">
                <option value="–ú–æ—Å–∫–≤–∞">–ú–æ—Å–∫–≤–∞</option>
                <option value="–î—Ä—É–≥–æ–π">–î—Ä—É–≥–æ–π –≥–æ—Ä–æ–¥</option>
            </select>
        </div>
        <div class="list-item" id="row-custom-city" style="display:none">
            <div class="item-label">–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥</div>
            <input type="text" id="custom-city" class="input-plain" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
        </div>
        <div class="list-item">
            <div class="item-label">–ê–¥—Ä–µ—Å *</div>
            <input type="text" id="address" class="input-plain" placeholder="–£–ª–∏—Ü–∞, –¥–æ–º">
        </div>
        <div class="list-item">
            <div class="item-label">–°–ø–æ—Å–æ–±</div>
            <select id="delivery" class="input-plain">
                <option value="–í–æ–¥–∏—Ç–µ–ª—å">–í–æ–¥–∏—Ç–µ–ª—å</option>
                <option value="–¢–∞–∫—Å–∏">–¢–∞–∫—Å–∏</option>
                <option value="–¢–ö">–°–î–≠–ö / –¢–ö</option>
            </select>
        </div>
        <div class="list-item">
            <div class="item-label">–í—Ä–µ–º—è</div>
            <select id="time" class="input-plain">
                <option value="10-14">10:00 - 14:00</option>
                <option value="14-18">14:00 - 18:00</option>
                <option value="–°—Ä–æ—á–Ω–æ">–ö–∞–∫ –º–æ–∂–Ω–æ —Å–∫–æ—Ä–µ–µ</option>
            </select>
        </div>
    </div>
</div>

<div id="tab-profile" class="screen">
    <div class="section-header">–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</div>
    <div class="list-group">
        <div class="list-item">
            <div class="item-label">–ò–º—è *</div>
            <input type="text" id="name" class="input-plain" placeholder="–í–∞—à–µ –∏–º—è">
        </div>
        <div class="list-item">
            <div class="item-label">–¢–µ–ª–µ—Ñ–æ–Ω *</div>
            <input type="tel" id="phone" class="input-plain" placeholder="+7...">
        </div>
        <div class="list-item">
            <div class="item-label">–°—Ç—É–¥–∏—è</div>
            <input type="text" id="studio" class="input-plain" placeholder="–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ">
        </div>
    </div>

    <div class="section-header">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ</div>
    <div class="list-group">
        <div class="list-item">
            <textarea id="comment" class="input-plain" style="text-align: left; height: 60px;" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É..."></textarea>
        </div>
    </div>

    <div style="padding: 0 16px;">
        <button class="main-btn" onclick="submitOrder()">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
    </div>
</div>

<div class="tab-bar">
    <div class="tab-item active" onclick="switchTab('menu')">
        <div class="tab-icon">üìë</div>
        <div>–ú–µ–Ω—é</div>
    </div>
    <div class="tab-item" onclick="switchTab('cart')" style="position: relative;">
        <div class="tab-icon">üõí</div>
        <div>–ö–æ—Ä–∑–∏–Ω–∞</div>
        <span id="badge" class="badge">0</span>
    </div>
    <div class="tab-item" onclick="switchTab('profile')">
        <div class="tab-icon">üë§</div>
        <div>–ü—Ä–æ—Ñ–∏–ª—å</div>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    // –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ (–º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å)
    const products = [
        "–ù190", "H190 Long (1.82)", "H210", "Sm 190 (–°–∞—Ç–∏–Ω)", "L190", 
        "M190 (–º–∞—Ç)", "N1", "N2", "N3", "–õ–æ–±–∞—à", 
        "–¢–æ–Ω–µ—Ä –¥–ª—è —Ñ–∞—Ä", "Crystal ultra gloss v2"
    ];

    let cart = {}; // –•—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞
    function renderCatalog() {
        const container = document.getElementById('catalog-list');
        container.innerHTML = products.map(p => `
            <div class="list-item">
                <div class="item-label">${p}</div>
                <div class="item-controls">
                    <div class="segment-control">
                        <button class="segment-btn active" id="btn-r-${p}" onclick="setUnit('${p}', '—Ä—É–ª.')">–†—É–ª</button>
                        <button class="segment-btn" id="btn-m-${p}" onclick="setUnit('${p}', '–º.')">–ú–µ—Ç—Ä</button>
                    </div>
                    <input type="number" id="qty-${p}" class="qty-input" placeholder="0" min="0" onchange="updateCart('${p}')">
                </div>
            </div>
        `).join('');
    }

    // –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è
    function setUnit(id, unit) {
        document.getElementById(`btn-r-${id}`).className = `segment-btn ${unit === '—Ä—É–ª.' ? 'active' : ''}`;
        document.getElementById(`btn-m-${id}`).className = `segment-btn ${unit === '–º.' ? 'active' : ''}`;
        updateCart(id);
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã
    function updateCart(id) {
        const qty = parseFloat(document.getElementById(`qty-${id}`).value);
        const unit = document.getElementById(`btn-r-${id}`).classList.contains('active') ? '—Ä—É–ª.' : '–º.';
        
        if (qty > 0) {
            cart[id] = { qty, unit };
        } else {
            delete cart[id];
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–µ–π–¥–∂–∏–∫–∞
        const count = Object.keys(cart).length;
        const badge = document.getElementById('badge');
        badge.innerText = count;
        badge.style.display = count > 0 ? 'block' : 'none';
        
        tg.HapticFeedback.selectionChanged();
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞–±–æ–≤
    function switchTab(tabName) {
        document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-item').forEach(el => el.classList.remove('active'));
        
        document.getElementById(`tab-${tabName}`).classList.add('active');
        
        // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–π –∏–∫–æ–Ω–∫–∏
        const tabIndex = tabName === 'menu' ? 0 : tabName === 'cart' ? 1 : 2;
        document.querySelectorAll('.tab-item')[tabIndex].classList.add('active');
    }

    // –ü–æ–∫–∞–∑ –ø–æ–ª—è "–î—Ä—É–≥–æ–π –≥–æ—Ä–æ–¥"
    function toggleCustomCity() {
        const val = document.getElementById('city').value;
        document.getElementById('row-custom-city').style.display = (val === '–î—Ä—É–≥–æ–π') ? 'flex' : 'none';
    }

    // –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–∫–∞–∑–∞ (—Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π)
    function submitOrder() {
        const name = document.getElementById('name').value.trim();
        const phone = document.getElementById('phone').value.trim();
        const address = document.getElementById('address').value.trim();
        
        // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã
        if (Object.keys(cart).length === 0) {
            tg.showAlert("–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞! –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä—ã –≤ –ú–µ–Ω—é.");
            switchTab('menu');
            return;
        }

        // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
        if (!name || !phone || !address) {
            tg.showAlert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –ò–º—è, –¢–µ–ª–µ—Ñ–æ–Ω –∏ –ê–¥—Ä–µ—Å.");
            if(!address) switchTab('cart');
            else switchTab('profile');
            return;
        }

        // 3. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        const cityVal = document.getElementById('city').value;
        const finalCity = cityVal === '–î—Ä—É–≥–æ–π' ? document.getElementById('custom-city').value : cityVal;

        const data = {
            cart: Object.keys(cart).map(key => ({
                item: key + (cart[key].unit === '–º.' ? ' (–æ—Ç—Ä–µ–∑)' : ''),
                qty: cart[key].qty,
                unit: cart[key].unit
            })),
            user: {
                name: name,
                phone: phone,
                city: finalCity,
                address: address,
                studio: document.getElementById('studio').value,
                delivery: document.getElementById('delivery').value,
                time: document.getElementById('time').value,
                comment: document.getElementById('comment').value
            }
        };

        tg.sendData(JSON.stringify(data));
        tg.close();
    }

    renderCatalog();
</script>
</body>
</html>
