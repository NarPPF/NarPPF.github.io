<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Store</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; margin: 0; padding: 0; padding-bottom: 80px; }
        .page { display: none; padding: 15px; }
        .page.active { display: block; }
        
        /* –ö–∞—Ç–∞–ª–æ–≥ */
        .card { background: #fff; border-radius: 12px; padding: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .add-btn { background: #0088cc; color: #fff; border: none; padding: 8px 12px; border-radius: 8px; }
        
        /* –§–æ—Ä–º–∞ –∑–∞–∫–∞–∑–∞ */
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 14px; }
        input, select, textarea { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc; box-sizing: border-box; }
        
        #footer { position: fixed; bottom: 0; width: 100%; background: #fff; padding: 15px; border-top: 1px solid #ddd; display: flex; justify-content: space-between; box-sizing: border-box; }
        .main-btn { background: #28a745; color: #fff; border: none; padding: 12px 20px; border-radius: 10px; font-weight: bold; flex-grow: 1; margin-left: 10px; }
        .back-btn { background: #6c757d; color: #fff; border: none; padding: 12px 20px; border-radius: 10px; }
    </style>
</head>
<body>

    <div id="catalog-page" class="page active">
        <h3>üíé –ö–∞—Ç–∞–ª–æ–≥ –ø–ª–µ–Ω–æ–∫</h3>
        <div id="items-container"></div>
    </div>

    <div id="checkout-page" class="page">
        <h3>üìç –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–∫–∏</h3>
        <div class="form-group">
            <label>–ò–º—è</label>
            <input type="text" id="f-name" placeholder="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤">
        </div>
        <div class="form-group">
            <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
            <input type="tel" id="f-phone" placeholder="+7...">
        </div>
        <div class="form-group">
            <label>–ì–æ—Ä–æ–¥</label>
            <select id="f-city" onchange="toggleCityLogic()">
                <option value="–ú–æ—Å–∫–≤–∞">–ú–æ—Å–∫–≤–∞</option>
                <option value="–†–µ–≥–∏–æ–Ω">–î—Ä—É–≥–æ–π –≥–æ—Ä–æ–¥</option>
            </select>
        </div>
        <div class="form-group">
            <label>–ê–¥—Ä–µ—Å / –¢–ö</label>
            <input type="text" id="f-addr" placeholder="–£–ª–∏—Ü–∞, –¥–æ–º –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –¢–ö">
        </div>
        <div id="moscow-only">
            <div class="form-group">
                <label>–í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏</label>
                <select id="f-time">
                    <option value="10:00 - 14:00">10:00 - 14:00</option>
                    <option value="14:00 - 18:00">14:00 - 18:00</option>
                    <option value="–°—Ä–æ—á–Ω–æ">üöÄ –°—Ä–æ—á–Ω–æ</option>
                </select>
            </div>
        </div>
        <div class="form-group">
            <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
            <textarea id="f-comm" rows="2"></textarea>
        </div>
    </div>

    <div id="footer">
        <button id="btn-left" class="back-btn" style="display:none" onclick="showPage('catalog')">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</button>
        <button id="btn-main" class="main-btn" onclick="nextStep()">–î–∞–ª–µ–µ (–ö–æ—Ä–∑–∏–Ω–∞: 0)</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        let cart = [];
        const products = ["–ù190", "H190 Long", "H210", "L190", "Crystal Matte", "–¶–≤–µ—Ç–Ω–∞—è –ø–ª–µ–Ω–∫–∞"];

        function renderCatalog() {
            const container = document.getElementById('items-container');
            container.innerHTML = products.map(p => `
                <div class="card">
                    <div><b>${p}</b></div>
                    <div>
                        <select id="t-${p}" style="width:70px"><option value="—Ä—É–ª.">–†—É–ª.</option><option value="–º.">–ú–µ—Ç—Ä</option></select>
                        <button class="add-btn" onclick="addToCart('${p}')">‚ûï</button>
                    </div>
                </div>
            `).join('');
        }

        function addToCart(p) {
            const type = document.getElementById(`t-${p}`).value;
            cart.push({ item: p + (type==='–º.'?' (–æ—Ç—Ä–µ–∑)':''), qty: 1, unit: type });
            document.getElementById('btn-main').innerText = `–î–∞–ª–µ–µ (–ö–æ—Ä–∑–∏–Ω–∞: ${cart.length})`;
            tg.HapticFeedback.impactOccurred('light');
        }

        function showPage(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            if(page === 'catalog') {
                document.getElementById('catalog-page').classList.add('active');
                document.getElementById('btn-left').style.display = 'none';
                document.getElementById('btn-main').innerText = `–î–∞–ª–µ–µ (–ö–æ—Ä–∑–∏–Ω–∞: ${cart.length})`;
            } else {
                document.getElementById('checkout-page').classList.add('active');
                document.getElementById('btn-left').style.display = 'block';
                document.getElementById('btn-main').innerText = `–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑ ‚úÖ`;
            }
        }

        function nextStep() {
            if (document.getElementById('catalog-page').classList.contains('active')) {
                if (cart.length === 0) return alert("–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä—ã!");
                showPage('checkout');
            } else {
                sendFinalData();
            }
        }

        function sendFinalData() {
            const userInfo = {
                name: document.getElementById('f-name').value,
                phone: document.getElementById('f-phone').value,
                city: document.getElementById('f-city').value,
                address: document.getElementById('f-addr').value,
                delivery_time: document.getElementById('f-time').value,
                comment: document.getElementById('f-comm').value,
                delivery_meth: document.getElementById('f-city').value === '–ú–æ—Å–∫–≤–∞' ? '–í–æ–¥–∏—Ç–µ–ª—å/–¢–∞–∫—Å–∏' : '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–∞—è –∫–æ–º–ø–∞–Ω–∏—è'
            };

            if(!userInfo.name || !userInfo.phone) return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω!");
            
            tg.sendData(JSON.stringify({ cart: cart, user_info: userInfo }));
        }

        renderCatalog();
    </script>
</body>
</html>