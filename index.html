<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ARMOTEK LUXE ORDER</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU" type="text/javascript"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --accent-color: #D4AF37; --bg-color: #000000; --card-bg: #121212; --text-color: #FFFFFF; --secondary-text: #888888; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-color); color: var(--text-color); margin: 0; padding: 0; overflow-x: hidden; }
        
        /* Header & Tabs */
        .header { padding: 20px; text-align: center; border-bottom: 1px solid #222; }
        .logo { width: 140px; filter: drop-shadow(0 0 5px rgba(212,175,55,0.3)); }
        .tabs { display: flex; justify-content: space-around; background: #0a0a0a; padding: 10px 0; position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid #222; }
        .tab-btn { background: none; border: none; color: var(--secondary-text); font-size: 13px; font-weight: 600; text-transform: uppercase; padding: 10px; cursor: pointer; }
        .tab-btn.active { color: var(--accent-color); border-bottom: 2px solid var(--accent-color); }

        /* Sections */
        .content-section { display: none; padding: 20px; padding-bottom: 100px; animation: fadeIn 0.3s ease; }
        .content-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Cards */
        .luxe-card { background: var(--card-bg); border-radius: 15px; padding: 15px; margin-bottom: 15px; border: 1px solid #222; }
        .product-title { font-size: 16px; font-weight: 600; margin-bottom: 5px; }
        .price-row { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; }
        .price { color: var(--accent-color); font-weight: 600; font-size: 18px; }
        .btn-add { background: var(--accent-color); color: black; border: none; padding: 8px 16px; border-radius: 8px; font-weight: 600; }

        /* Inputs & Map */
        .input-luxe { width: 100%; background: #1a1a1a; border: 1px solid #333; color: white; padding: 12px; border-radius: 10px; margin-top: 10px; box-sizing: border-box; outline: none; }
        #map { width: 100%; height: 200px; border-radius: 12px; margin-top: 15px; border: 1px solid #333; }

        /* Payment Modal */
        .modal-pay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 3000; display: none; align-items: center; justify-content: center; }
        .pay-card { background: var(--card-bg); width: 85%; padding: 25px; border-radius: 20px; border: 1px solid var(--accent-color); text-align: center; }
        .pay-option { background: #1a1a1a; padding: 15px; border-radius: 12px; margin: 10px 0; border: 1px solid #333; color: white; cursor: pointer; text-align: left; }
    </style>
</head>
<body>

    <div class="header"><img src="https://armotek.pro/wp-content/uploads/2023/10/logo-armotek.png" class="logo"></div>

    <div class="tabs">
        <button class="tab-btn active" onclick="showTab('catalog')">–ö–∞—Ç–∞–ª–æ–≥</button>
        <button class="tab-btn" onclick="showTab('cart')">–ö–æ—Ä–∑–∏–Ω–∞ (<span id="cart-count">0</span>)</button>
        <button class="tab-btn" onclick="showTab('profile')">–ü—Ä–æ—Ñ–∏–ª—å</button>
    </div>

    <div id="catalog" class="content-section active">
        <div id="product-list"></div>
    </div>

    <div id="cart" class="content-section">
        <div id="cart-items"></div>
        <div class="luxe-card" style="margin-top:20px; text-align:right;">
            <div style="color:var(--secondary-text)">–ò—Ç–æ–≥–æ:</div>
            <div id="cart-total" style="font-size:24px; color:var(--accent-color); font-weight:600;">0 ‚ÇΩ</div>
        </div>
        <button onclick="checkout()" style="width:100%; background:var(--accent-color); color:black; border:none; padding:18px; border-radius:12px; font-weight:600; font-size:16px; margin-top:20px;">–û–§–û–†–ú–ò–¢–¨</button>
    </div>

    <div id="profile" class="content-section">
        <div class="luxe-card">
            <div id="user-name" style="font-size:18px; font-weight:600;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            <div id="user-status" style="color:var(--accent-color); font-size:12px; margin-top:4px;">–ö–ª–∏–µ–Ω—Ç</div>
        </div>
        <div class="luxe-card">
            <div>üìç –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏:</div>
            <input type="text" id="manual-address" class="input-luxe" placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –≤—Ä—É—á–Ω—É—é..." oninput="updateAddrText(this.value)">
            <div id="map"></div>
        </div>
    </div>

    <div id="payment-modal" class="modal-pay">
        <div class="pay-card">
            <h3 style="color: var(--accent-color);">–û–ø–ª–∞—Ç–∞</h3>
            <div class="pay-option" onclick="selectPay('–†–µ–∫–≤–∏–∑–∏—Ç—ã/–§–∞–π–ª')">üìÑ –†–µ–∫–≤–∏–∑–∏—Ç—ã / –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–∞–π–ª</div>
            <div class="pay-option" onclick="selectPay('QR-–∫–æ–¥')">üì± QR-–∫–æ–¥ (–°–ë–ü)</div>
            <button onclick="document.getElementById('payment-modal').style.display='none'" style="background:none; border:none; color:grey; margin-top:15px;">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

<script>
    let tg = window.Telegram.WebApp;
    tg.expand();
    
    let cart = [];
    let tempOrderData = null;
    let userProfile = { isDealer: false, address: '' };

    const products = [
        { id: 1, name: "NAR PPF H190", price: 55000, dPrice: 48000 },
        { id: 2, name: "NAR PPF Matte", price: 62000, dPrice: 54000 },
        { id: 3, name: "NAR PPF H210", price: 68000, dPrice: 61000 },
        { id: 4, name: "–í—ã–≥–æ–Ω–∫–∞ Blue Max", price: 1200, dPrice: 950 }
    ];

    function showTab(tabId) {
        document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        event.currentTarget.classList.add('active');
        if(tabId === 'profile') initMap();
    }

    function renderProducts() {
        const list = document.getElementById('product-list');
        list.innerHTML = products.map(p => `
            <div class="luxe-card">
                <div class="product-title">${p.name}</div>
                <div class="price-row">
                    <div class="price">${(userProfile.isDealer ? p.dPrice : p.price).toLocaleString()} ‚ÇΩ</div>
                    <button class="btn-add" onclick="addToCart(${p.id})">–í –ö–û–†–ó–ò–ù–£</button>
                </div>
            </div>
        `).join('');
    }

    function addToCart(id) {
        const p = products.find(i => i.id === id);
        const inCart = cart.find(i => i.id === id);
        if (inCart) inCart.qty++; else cart.push({...p, qty: 1});
        updateCart();
        tg.HapticFeedback.impactOccurred('light');
    }

    function updateCart() {
        document.getElementById('cart-count').innerText = cart.reduce((s, i) => s + i.qty, 0);
        const list = document.getElementById('cart-items');
        list.innerHTML = cart.map(i => `
            <div class="cart-item" style="display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid #222;">
                <div>${i.name} x${i.qty}</div>
                <div style="color:var(--accent-color)">${((userProfile.isDealer ? i.dPrice : i.price) * i.qty).toLocaleString()} ‚ÇΩ</div>
            </div>
        `).join('');
        const total = cart.reduce((s, i) => s + (userProfile.isDealer ? i.dPrice : i.price) * i.qty, 0);
        document.getElementById('cart-total').innerText = total.toLocaleString() + " ‚ÇΩ";
    }

    function updateAddrText(val) { userProfile.address = val; }

    function checkout() {
        const addr = document.getElementById('manual-address').value || userProfile.address;
        if (cart.length === 0) return tg.showAlert("–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞");
        if (!addr || addr.length < 5) return tg.showAlert("–£–∫–∞–∂–∏—Ç–µ –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏");

        tempOrderData = {
            items: cart.map(i => ({ name: i.name, qty: i.qty })),
            total: cart.reduce((s, i) => s + (userProfile.isDealer ? i.dPrice : i.price) * i.qty, 0),
            address: addr,
            username: tg.initDataUnsafe.user?.username || "Guest"
        };
        document.getElementById('payment-modal').style.display = 'flex';
    }

    function selectPay(method) {
        tempOrderData.paymentMethod = method;
        tg.confirm(`–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑ –Ω–∞ ${tempOrderData.total.toLocaleString()} ‚ÇΩ?`, (ok) => {
            if(ok) {
                tg.sendData(JSON.stringify(tempOrderData));
                tg.close();
            }
        });
    }

    function initMap() {
        if (window.myMap) return;
        ymaps.ready(() => {
            window.myMap = new ymaps.Map("map", { center: [55.75, 37.61], zoom: 10 });
            window.myMap.events.add('click', e => {
                const coords = e.get('coords');
                ymaps.geocode(coords).then(res => {
                    const addr = res.geoObjects.get(0).getAddressLine();
                    document.getElementById('manual-address').value = addr;
                    userProfile.address = addr;
                });
            });
        });
    }

    document.getElementById('user-name').innerText = tg.initDataUnsafe.user?.first_name || "–ö–ª–∏–µ–Ω—Ç";
    renderProducts();
</script>
</body>
</html>
