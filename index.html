<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ó–∞–∫–∞–∑ –ø—Ä–æ–¥—É–∫—Ü–∏–∏</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --tg-theme-bg-color: #ffffff;
            --tg-theme-secondary-bg-color: #f0f2f5;
            --tg-theme-button-color: #248bed;
            --tg-theme-button-text-color: #ffffff;
            --tg-theme-text-color: #000000;
            --tg-theme-hint-color: #999999;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--tg-theme-secondary-bg-color);
            color: var(--tg-theme-text-color);
            margin: 0; padding: 0; overflow: hidden;
        }

        .container {
            display: flex; flex-direction: column; height: 100vh;
        }

        .header {
            padding: 15px; background: var(--tg-theme-bg-color);
            text-align: center; font-weight: bold; border-bottom: 1px solid #ddd;
        }

        .content {
            flex-grow: 1; overflow-y: auto; padding: 15px; padding-bottom: 100px;
        }

        .step { display: none; }
        .step.active { display: block; }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ */
        .item-card {
            background: var(--tg-theme-bg-color);
            border-radius: 12px; padding: 12px; margin-bottom: 10px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .item-title { font-weight: 600; font-size: 15px; margin-bottom: 5px; }

        input, select, textarea {
            width: 100%; padding: 12px; margin-top: 5px;
            border-radius: 10px; border: 1px solid #ddd;
            background: var(--tg-theme-bg-color); color: var(--tg-theme-text-color);
            font-size: 16px; box-sizing: border-box;
        }

        .footer {
            position: fixed; bottom: 0; width: 100%;
            padding: 15px; background: var(--tg-theme-bg-color);
            display: flex; gap: 10px; box-sizing: border-box;
            border-top: 1px solid #ddd;
        }

        button {
            flex: 1; padding: 14px; border-radius: 12px;
            border: none; font-size: 16px; font-weight: 600; cursor: pointer;
        }

        .btn-next { background: var(--tg-theme-button-color); color: var(--tg-theme-button-text-color); }
        .btn-back { background: #e0e0e0; color: #333; }

        .badge { background: #ff3b30; color: white; padding: 2px 6px; border-radius: 8px; font-size: 12px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header" id="step-title">–®–∞–≥ 1: –í—ã–±–æ—Ä —Ç–æ–≤–∞—Ä–∞</div>
    
    <div class="content">
        <div id="step-1" class="step active">
            <div id="catalog"></div>
        </div>

        <div id="step-2" class="step">
            <label>–ì–æ—Ä–æ–¥ –¥–æ—Å—Ç–∞–≤–∫–∏</label>
            <select id="city" onchange="updateCityFields()">
                <option value="–ú–æ—Å–∫–≤–∞">–ú–æ—Å–∫–≤–∞</option>
                <option value="–î—Ä—É–≥–æ–π">–î—Ä—É–≥–æ–π –≥–æ—Ä–æ–¥</option>
            </select>
            
            <div id="other-city-group" style="display:none; margin-top:15px;">
                <label>–£–∫–∞–∂–∏—Ç–µ –≤–∞—à –≥–æ—Ä–æ–¥</label>
                <input type="text" id="custom-city" placeholder="–ù–∞–ø—Ä: –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥">
            </div>

            <div style="margin-top:15px;">
                <label>–ê–¥—Ä–µ—Å (—É–ª–∏—Ü–∞, –¥–æ–º)</label>
                <input type="text" id="address" placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å">
            </div>

            <div style="margin-top:15px;">
                <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—É–¥–∏–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)</label>
                <input type="text" id="studio" placeholder="–ù–∞–ø—Ä: Wrap Studio">
            </div>
        </div>

        <div id="step-3" class="step">
            <label>–°–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏</label>
            <select id="delivery_meth">
                <option value="–í–æ–¥–∏—Ç–µ–ª—å">üöõ –í–æ–¥–∏—Ç–µ–ª—å</option>
                <option value="–¢–∞–∫—Å–∏">üöï –¢–∞–∫—Å–∏</option>
                <option value="–¢–ö">üì¶ –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–∞—è –∫–æ–º–ø–∞–Ω–∏—è (–°–î–≠–ö/–∏ –¥—Ä.)</option>
            </select>

            <div style="margin-top:15px;">
                <label>–î–µ–Ω—å –¥–æ—Å—Ç–∞–≤–∫–∏</label>
                <select id="delivery_day">
                    <option value="–°–µ–≥–æ–¥–Ω—è">–°–µ–≥–æ–¥–Ω—è</option>
                    <option value="–ó–∞–≤—Ç—Ä–∞">–ó–∞–≤—Ç—Ä–∞</option>
                </select>
            </div>

            <div style="margin-top:15px;">
                <label>–£–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è</label>
                <select id="delivery_time">
                    <option value="10:00 - 14:00">10:00 - 14:00</option>
                    <option value="14:00 - 18:00">14:00 - 18:00</option>
                    <option value="–°—Ä–æ—á–Ω–æ">üöÄ –ö–∞–∫ –º–æ–∂–Ω–æ —Å–∫–æ—Ä–µ–µ</option>
                </select>
            </div>
        </div>

        <div id="step-4" class="step">
            <label>–í–∞—à–µ –ò–º—è</label>
            <input type="text" id="u_name" placeholder="–ò–≤–∞–Ω">

            <div style="margin-top:15px;">
                <label>–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
                <input type="tel" id="u_phone" placeholder="+7 (___) ___-__-__">
            </div>

            <div style="margin-top:15px;">
                <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É</label>
                <textarea id="u_comm" rows="3" placeholder="–î–æ–ø. –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è..."></textarea>
            </div>
        </div>
    </div>

    <div class="footer">
        <button id="btn-back" class="btn-back" style="display:none" onclick="changeStep(-1)">–ù–∞–∑–∞–¥</button>
        <button id="btn-next" class="btn-next" onclick="changeStep(1)">–î–∞–ª–µ–µ</button>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    let currentStep = 1;
    let cart = [];
    const products = [
        "–ù190", "H190 Long (1.82)", "H210", "Sm 190 (–°–∞—Ç–∏–Ω)", "L190", "M190 (–º–∞—Ç)", 
        "N1", "N2", "N3", "–õ–æ–±–∞—à", "–¢–æ–Ω–µ—Ä –¥–ª—è —Ñ–∞—Ä", "Crystal ultra gloss v2"
    ];

    function initCatalog() {
        const cat = document.getElementById('catalog');
        cat.innerHTML = products.map(p => `
            <div class="item-card">
                <div class="item-info">
                    <div class="item-title">${p}</div>
                    <select id="mode-${p}" style="width:80px; font-size:12px; padding:5px;">
                        <option value="—Ä—É–ª.">–†—É–ª.</option>
                        <option value="–º.">–ú–µ—Ç—Ä</option>
                    </select>
                </div>
                <div style="display:flex; align-items:center; gap:5px;">
                    <input type="number" id="q-${p}" value="0" min="0" step="0.1" style="width:60px; margin:0;" onchange="updateCart('${p}')">
                </div>
            </div>
        `).join('');
    }

    function updateCart(p) {
        const qty = parseFloat(document.getElementById(`q-${p}`).value);
        const mode = document.getElementById(`mode-${p}`).value;
        const idx = cart.findIndex(i => i.id === p);

        if (qty > 0) {
            const itemData = { id: p, item: p + (mode === '–º.' ? ' (–æ—Ç—Ä–µ–∑)' : ''), qty: qty, unit: mode };
            if (idx > -1) cart[idx] = itemData; else cart.push(itemData);
        } else if (idx > -1) {
            cart.splice(idx, 1);
        }
        tg.HapticFeedback.impactOccurred('light');
    }

    function updateCityFields() {
        const isOther = document.getElementById('city').value === '–î—Ä—É–≥–æ–π';
        document.getElementById('other-city-group').style.display = isOther ? 'block' : 'none';
    }

    function changeStep(dir) {
        if (dir === 1 && currentStep === 1 && cart.length === 0) {
            alert("–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä!"); return;
        }

        currentStep += dir;
        if (currentStep < 1) currentStep = 1;
        if (currentStep > 4) { sendFinal(); return; }

        document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
        document.getElementById(`step-${currentStep}`).classList.add('active');
        
        document.getElementById('btn-back').style.display = currentStep === 1 ? 'none' : 'block';
        document.getElementById('btn-next').innerText = currentStep === 4 ? '–û—Ñ–æ—Ä–º–∏—Ç—å ‚úÖ' : '–î–∞–ª–µ–µ';
        
        const titles = ["", "–í—ã–±–æ—Ä —Ç–æ–≤–∞—Ä–∞", "–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏", "–î–µ—Ç–∞–ª–∏ –¥–æ—Å—Ç–∞–≤–∫–∏", "–ö–æ–Ω—Ç–∞–∫—Ç—ã"];
        document.getElementById('step-title').innerText = `–®–∞–≥ ${currentStep}: ${titles[currentStep]}`;
    }

    function sendFinal() {
        const data = {
            cart: cart,
            user: {
                name: document.getElementById('u_name').value,
                phone: document.getElementById('u_phone').value,
                city: document.getElementById('city').value === '–ú–æ—Å–∫–≤–∞' ? '–ú–æ—Å–∫–≤–∞' : document.getElementById('custom-city').value,
                address: document.getElementById('address').value,
                studio: document.getElementById('studio').value,
                delivery: document.getElementById('delivery_meth').value,
                day: document.getElementById('delivery_day').value,
                time: document.getElementById('delivery_time').value,
                comment: document.getElementById('u_comm').value
            }
        };

        if (!data.user.name || !data.user.phone) {
            alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω!");
            currentStep = 4; changeStep(0); return;
        }

        tg.sendData(JSON.stringify(data));
    }

    initCatalog();
</script>
</body>
</html>
