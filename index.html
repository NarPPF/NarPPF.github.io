<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>NAR PPF</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
body { font-family: Arial; padding: 20px; }
.product { border-bottom: 1px solid #ddd; padding: 10px 0; }
button { padding: 8px 12px; }
</style>
</head>
<body>

<h2>NAR PPF — Каталог</h2>
<div id="list"></div>
<button onclick="order()">Оформить заказ</button>

<script>
const tg = window.Telegram.WebApp;
tg.ready();

const API_URL = "https://YOUR_DOMAIN";
let cart = [];

async function load() {
  const res = await fetch(API_URL + "/products", {
    headers: { "X-Telegram-Init": tg.initData }
  });
  const data = await res.json();
  const list = document.getElementById("list");
  data.forEach(p => {
    const div = document.createElement("div");
    div.className = "product";
    div.innerHTML = `<b>${p.name}</b><br>Цена: ${p.price} ₽<br>
      <button onclick='add("${p.name}")'>Добавить</button>`;
    list.appendChild(div);
  });
}

function add(name) {
  cart.push(name);
  tg.showAlert("Добавлено: " + name);
}

async function order() {
  if (!cart.length) {
    tg.showAlert("Корзина пуста");
    return;
  }

  await fetch(API_URL + "/order", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "X-Telegram-Init": tg.initData
    },
    body: JSON.stringify({
      uid: tg.initDataUnsafe.user.id,
      items: cart
    })
  });

  tg.showAlert("Заказ отправлен");
  cart = [];
}

load();
</script>
</body>
</html>
