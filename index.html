<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Premium Catalog</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #f2f2f7;
            --card-bg: #ffffff;
            --accent: #007aff;
            --text: #000000;
            --hint: #8e8e93;
        }

        body {
            font-family: -apple-system, system-ui, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0; padding: 0;
            user-select: none;
        }

        /* –°—Ç–∏–ª—å "–ú–µ–Ω—é" –∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞—Ö */
        .header {
            padding: 20px 15px;
            background: var(--card-bg);
            border-bottom: 0.5px solid #d1d1d6;
            text-align: left;
        }
        .header h1 { margin: 0; font-size: 24px; font-weight: 800; }
        .header p { margin: 5px 0 0; color: var(--hint); font-size: 14px; }

        .content { padding: 15px; padding-bottom: 120px; }

        /* –ö–∞—Ä—Ç–æ—á–∫–∞ —Ç–æ–≤–∞—Ä–∞ */
        .product-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }
        .product-card:active { transform: scale(0.98); }

        .p-info { flex-grow: 1; }
        .p-title { font-weight: 700; font-size: 17px; margin-bottom: 4px; }
        .p-price { color: var(--accent); font-weight: 600; font-size: 14px; }

        .p-actions { display: flex; flex-direction: column; align-items: flex-end; gap: 8px; }
        
        .unit-selector {
            background: #f2f2f7;
            border-radius: 8px;
            padding: 4px;
            display: flex;
            gap: 2px;
        }
        .unit-btn {
            padding: 4px 8px;
            font-size: 11px;
            border-radius: 6px;
            border: none;
            background: transparent;
            font-weight: 600;
        }
        .unit-btn.active { background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }

        .qty-input {
            width: 70px;
            padding: 8px;
            border-radius: 10px;
            border: 1px solid #d1d1d6;
            text-align: center;
            font-weight: bold;
        }

        /* –ü–æ–ª—è –≤–≤–æ–¥–∞ (–®–∞–≥ 2-4) */
        .form-group { margin-bottom: 16px; }
        .form-label { font-size: 13px; font-weight: 600; color: var(--hint); margin-left: 5px; margin-bottom: 5px; display: block; }
        input[type="text"], input[type="tel"], select, textarea {
            width: 100%;
            padding: 14px;
            border-radius: 12px;
            border: none;
            background: var(--card-bg);
            font-size: 16px;
            box-sizing: border-box;
            box-shadow: 0 2px 6px rgba(0,0,0,0.03);
        }

        /* –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
        .footer-nav {
            position: fixed;
            bottom: 0; width: 100%;
            background: rgba(255,255,255,0.85);
            backdrop-filter: blur(15px);
            padding: 20px;
            box-sizing: border-box;
            border-top: 0.5px solid #d1d1d6;
            display: flex; gap: 10px;
        }
        .btn {
            flex: 1;
            padding: 16px;
            border-radius: 14px;
            border: none;
            font-weight: 700;
            font-size: 16px;
        }
        .btn-main { background: var(--accent); color: white; }
        .btn-back { background: #e5e5ea; color: #000; }

        .step { display: none; animation: fadeIn 0.3s; }
        .step.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<div id="app">
    <div class="header">
        <h1 id="main-title">–ö–∞—Ç–∞–ª–æ–≥</h1>
        <p id="sub-title">–í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏</p>
    </div>

    <div class="content">
        <div id="step-1" class="step active">
            <div id="catalog-list"></div>
        </div>

        <div id="step-2" class="step">
            <div class="form-group">
                <label class="form-label">–ì–û–†–û–î</label>
                <select id="city" onchange="checkCity()">
                    <option value="–ú–æ—Å–∫–≤–∞">üèô –ú–æ—Å–∫–≤–∞</option>
                    <option value="–†–µ–≥–∏–æ–Ω">üåç –î—Ä—É–≥–æ–π –≥–æ—Ä–æ–¥</option>
                </select>
            </div>
            <div id="city-manual" class="form-group" style="display:none">
                <label class="form-label">–£–ö–ê–ñ–ò–¢–ï –ì–û–†–û–î</label>
                <input type="text" id="custom-city" placeholder="–ù–∞–ø—Ä: –ö–∞–∑–∞–Ω—å">
            </div>
            <div class="form-group">
                <label class="form-label">–ê–î–†–ï–° –î–û–°–¢–ê–í–ö–ò</label>
                <input type="text" id="address" placeholder="–£–ª–∏—Ü–∞, –¥–æ–º, –∫–≤">
            </div>
            <div class="form-group">
                <label class="form-label">–°–¢–£–î–ò–Ø (–û–ü–¶–ò–û–ù–ê–õ–¨–ù–û)</label>
                <input type="text" id="studio" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∞—à–µ–π —Å—Ç—É–¥–∏–∏">
            </div>
        </div>

        <div id="step-3" class="step">
            <div class="form-group">
                <label class="form-label">–°–ü–û–°–û–ë –î–û–°–¢–ê–í–ö–ò</label>
                <select id="del_meth">
                    <option value="–í–æ–¥–∏—Ç–µ–ª—å">üöõ –í–æ–¥–∏—Ç–µ–ª—å</option>
                    <option value="–¢–∞–∫—Å–∏">üöï –¢–∞–∫—Å–∏</option>
                    <option value="–¢–ö">üì¶ –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–∞—è –∫–æ–º–ø–∞–Ω–∏—è</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">–î–ï–ù–¨</label>
                <select id="del_day">
                    <option value="–°–µ–≥–æ–¥–Ω—è">–°–µ–≥–æ–¥–Ω—è</option>
                    <option value="–ó–∞–≤—Ç—Ä–∞">–ó–∞–≤—Ç—Ä–∞</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">–í–†–ï–ú–Ø</label>
                <select id="del_time">
                    <option value="10:00 - 14:00">10:00 - 14:00</option>
                    <option value="14:00 - 18:00">14:00 - 18:00</option>
                    <option value="–°—Ä–æ—á–Ω–æ">üöÄ –ö–∞–∫ –º–æ–∂–Ω–æ —Å–∫–æ—Ä–µ–µ</option>
                </select>
            </div>
        </div>

        <div id="step-4" class="step">
            <div class="form-group">
                <label class="form-label">–í–ê–®–ï –ò–ú–Ø</label>
                <input type="text" id="u_name" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
            </div>
            <div class="form-group">
                <label class="form-label">–¢–ï–õ–ï–§–û–ù</label>
                <input type="tel" id="u_phone" placeholder="+7 (___) ___-__-__">
            </div>
            <div class="form-group">
                <label class="form-label">–ö–û–ú–ú–ï–ù–¢–ê–†–ò–ô</label>
                <textarea id="u_comm" rows="3" placeholder="–î–æ–ø. –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è..."></textarea>
            </div>
        </div>
    </div>

    <div class="footer-nav">
        <button id="btn-back" class="btn btn-back" style="display:none" onclick="goStep(-1)">–ù–∞–∑–∞–¥</button>
        <button id="btn-next" class="btn btn-main" onclick="goStep(1)">–î–∞–ª–µ–µ</button>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();
    tg.MainButton.hide();

    let step = 1;
    let cart = {};
    const items = [
        "–ù190", "H190 Long (1.82)", "H210", "Sm 190 (–°–∞—Ç–∏–Ω)", "L190", "M190 (–º–∞—Ç)", 
        "N1", "N2", "N3", "–õ–æ–±–∞—à", "–¢–æ–Ω–µ—Ä –¥–ª—è —Ñ–∞—Ä", "Crystal ultra gloss v2"
    ];

    function init() {
        const list = document.getElementById('catalog-list');
        list.innerHTML = items.map(name => `
            <div class="product-card">
                <div class="p-info">
                    <div class="p-title">${name}</div>
                    <div class="p-price">–î–æ—Å—Ç—É–ø–Ω–æ –∫ –∑–∞–∫–∞–∑—É</div>
                </div>
                <div class="p-actions">
                    <div class="unit-selector">
                        <button class="unit-btn active" id="u-r-${name}" onclick="setUnit('${name}', '—Ä—É–ª.')">—Ä—É–ª.</button>
                        <button class="unit-btn" id="u-m-${name}" onclick="setUnit('${name}', '–º.')">–º.</button>
                    </div>
                    <input type="number" class="qty-input" id="q-${name}" placeholder="0" min="0" onchange="syncCart('${name}')">
                </div>
            </div>
        `).join('');
    }

    function setUnit(name, unit) {
        document.getElementById(`u-r-${name}`).classList.toggle('active', unit==='—Ä—É–ª.');
        document.getElementById(`u-m-${name}`).classList.toggle('active', unit==='–º.');
        syncCart(name);
    }

    function syncCart(name) {
        const q = parseFloat(document.getElementById(`q-${name}`).value) || 0;
        const u = document.getElementById(`u-r-${name}`).classList.contains('active') ? '—Ä—É–ª.' : '–º.';
        if(q > 0) cart[name] = { qty: q, unit: u }; else delete cart[name];
        tg.HapticFeedback.selectionChanged();
    }

    function checkCity() {
        document.getElementById('city-manual').style.display = (document.getElementById('city').value === '–†–µ–≥–∏–æ–Ω') ? 'block' : 'none';
    }

    function goStep(dir) {
        if(dir === 1 && step === 1 && Object.keys(cart).length === 0) { alert("–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä!"); return; }
        
        step += dir;
        document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
        document.getElementById(`step-${step}`).classList.add('active');
        
        document.getElementById('btn-back').style.display = step === 1 ? 'none' : 'block';
        document.getElementById('btn-next').innerText = step === 4 ? '–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑' : '–î–∞–ª–µ–µ';
        
        const titles = ["", "–ö–∞—Ç–∞–ª–æ–≥", "–ê–¥—Ä–µ—Å", "–î–æ—Å—Ç–∞–≤–∫–∞", "–ö–æ–Ω—Ç–∞–∫—Ç—ã"];
        const subs = ["", "–í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–µ–Ω–∫—É", "–ö—É–¥–∞ –≤–µ–∑–µ–º?", "–ö–∞–∫ –∏ –∫–æ–≥–¥–∞?", "–§–∏–Ω–∞–ª—å–Ω—ã–µ —à—Ç—Ä–∏—Ö–∏"];
        document.getElementById('main-title').innerText = titles[step];
        document.getElementById('sub-title').innerText = subs[step];

        if(step > 4) sendData();
    }

    function sendData() {
        const data = {
            cart: Object.keys(cart).map(k => ({ item: k + (cart[k].unit==='–º.'?' (–æ—Ç—Ä–µ–∑)':''), qty: cart[k].qty, unit: cart[k].unit })),
            user: {
                name: document.getElementById('u_name').value,
                phone: document.getElementById('u_phone').value,
                city: document.getElementById('city').value === '–ú–æ—Å–∫–≤–∞' ? '–ú–æ—Å–∫–≤–∞' : document.getElementById('custom-city').value,
                address: document.getElementById('address').value,
                studio: document.getElementById('studio').value,
                delivery: document.getElementById('del_meth').value,
                day: document.getElementById('del_day').value,
                time: document.getElementById('del_time').value,
                comment: document.getElementById('u_comm').value
            }
        };
        tg.sendData(JSON.stringify(data));
    }

    init();
</script>
</body>
</html>
