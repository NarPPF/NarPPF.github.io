<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>NAR PPF</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
body { font-family: Arial; padding: 16px; }
.item { border-bottom: 1px solid #ddd; padding: 10px 0; }
button { padding: 8px 12px; margin-top: 6px; }
</style>
</head>
<body>

<h2>NAR PPF — Каталог</h2>
<div id="items">Загрузка...</div>
<button onclick="sendOrder()">Оформить заказ</button>

<script>
const tg = window.Telegram.WebApp;
tg.ready();

const API_URL = "https://nar-ppf.ru"; // ← ЗАМЕНИ ТОЛЬКО ЭТО
let cart = [];

async function load() {
  const r = await fetch(API_URL + "/products", {
    headers: { "X-Telegram-Init": tg.initData }
  });
  const data = await r.json();

  const el = document.getElementById("items");
  el.innerHTML = "";

  data.forEach(p => {
    const d = document.createElement("div");
    d.className = "item";
    d.innerHTML = `<b>${p.name}</b><br>${p.price} ₽
      <br><button onclick="add('${p.name}')">Добавить</button>`;
    el.appendChild(d);
  });
}

function add(name) {
  cart.push(name);
  tg.showAlert("Добавлено");
}

async function sendOrder() {
  if (!cart.length) {
    tg.showAlert("Корзина пуста");
    return;
  }

  await fetch(API_URL + "/order", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "X-Telegram-Init": tg.initData
    },
    body: JSON.stringify({
      uid: tg.initDataUnsafe.user.id,
      items: cart
    })
  });

  tg.showAlert("Заказ отправлен");
  cart = [];
}

load();
</script>

</body>
</html>
