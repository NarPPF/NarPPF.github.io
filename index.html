<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Armotek Catalog</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
body { background:#121212; color:white; font-family:sans-serif; margin:0 }
.header { padding:15px; background:#1e1e1e; text-align:center }
#city-selector { cursor:pointer; color:#D4AF37; font-size:13px }
.grid { display:grid; grid-template-columns:1fr 1fr; gap:10px; padding:10px }
.card { background:#1e1e1e; padding:10px; border-radius:8px }
button { background:#D4AF37; border:none; padding:10px; width:100% }
</style>
</head>

<body>
<div class="header">
    <b>ARMOTEK FILMS</b><br>
    <div id="city-selector" onclick="openCityModal()">Москва ▼</div>
    <div id="delivery-info" style="font-size:11px;color:#777">
        Доставка по Москве — бесплатно
    </div>
</div>

<div class="grid" id="grid"></div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

let userProfile = { city: "Москва" };

const cities = [
 "Москва","Санкт-Петербург","Казань","Екатеринбург",
 "Новосибирск","Краснодар","Ростов-на-Дону"
];

const products = [
 {id:1,name:"NAR PPF H190",price:45000},
 {id:2,name:"Crystal Matte",price:30000}
];

let cart = [];

function openCityModal() {
 const city = prompt("Выберите город:", userProfile.city);
 if (city && cities.includes(city)) {
   userProfile.city = city;
   document.getElementById("city-selector").innerText = city + " ▼";
   document.getElementById("delivery-info").innerText =
     city === "Москва"
     ? "Доставка по Москве — бесплатно"
     : "Доставка — по тарифу ТК";
 }
}

function render() {
 const g = document.getElementById("grid");
 g.innerHTML = "";
 products.forEach(p=>{
   const d = document.createElement("div");
   d.className="card";
   d.innerHTML = `
     <b>${p.name}</b><br>
     ${p.price} ₽<br><br>
     <button onclick="add(${p.id})">В корзину</button>
   `;
   g.appendChild(d);
 });
}

function add(id) {
 const p = products.find(x=>x.id===id);
 cart.push({...p, qty:1});
 alert("Добавлено");
 sendOrder();
}

function sendOrder() {
 const data = {
   cart: cart,
   total_price: cart.reduce((a,c)=>a+c.price,0),
   delivery_price_info:
     userProfile.city==="Москва"?"free_moscow":"tk_tariff"
 };
 tg.sendData(JSON.stringify(data));
}

render();
</script>
</body>
</html>
